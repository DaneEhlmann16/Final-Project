{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<h1>Admin Dashboard</h1>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul style="color: red;">
      {% for m in messages %}
        <li>{{ m }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<p>Logged in as: {{ session.get('admin_username') }}</p>

<p>
    <a href="{{ url_for('admin_logout') }}">Logout</a> |
    <a href="{{ url_for('index') }}">Back to main menu</a>
</p>

<hr>

<h2>Total Sales</h2>
<p><strong>${{ total_sales }}</strong></p>

<hr>

<h2>Seating Chart (X = reserved, O = open)</h2>
<table border="1" cellpadding="5">
    <tr>
        <th>Row</th>
        <th>Seat 1</th>
        <th>Seat 2</th>
        <th>Seat 3</th>
        <th>Seat 4</th>
    </tr>
    {% for row_index, row in enumerate(seating_chart, start=1) %}
    <tr>
        <td>{{ row_index }}</td>
        {% for seat in row %}
        <td style="text-align:center;">{{ seat }}</td>
        {% endfor %}
    </tr>
    {% endfor %}
</table>

<hr>

<h2>Reservations</h2>

{% if reservations %}
    <table border="1" cellpadding="5">
        <tr>
            <th>ID</th>
            <th>Passenger</th>
            <th>Row</th>
            <th>Column</th>
            <th>eTicket</th>
            <th>Delete</th>
        </tr>
        {% for r in reservations %}
        <tr>
            <td>{{ r["id"] }}</td>
            <td>{{ r["passengerName"] }}</td>
            <td>{{ r["seatRow"] }}</td>
            <td>{{ r["seatColumn"] }}</td>
            <td>{{ r["eTicketNumber"] }}</td>
            <td>
                <form method="post" action="{{ url_for('delete_reservation', reservation_id=r['id']) }}">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        {% endfor %}
    </table>
{% else %}
    <p>No reservations yet.</p>
{% endif %}

{% endblock %}
